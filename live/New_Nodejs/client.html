<!--

	//check if user logged in
	//if not redirect to login page
	//require_once("../../includes/session.php"); 
	//confirm_logged_in();
	//$username = $_SESSION['username'];
	
-->

<DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title> WebSockets Chat Window </title>
	<link href="css/styledoc.css" rel="stylesheet" type="text/css"/>
	<script language="JavaScript" type="text/javascript" src="js/jquery-3.1.1.js"></script>

</head>

<body>
	<div>
		<h1> Chat App </h1>
	</div>
	<div style="position: absolute; bottom: 30px; width: 90%; height: 400px; ">
		<div align="center" width="350px" height="100%">
			<table>
				<tr >
					<td width="350px"; height="400px"; >
						<div id="log"></div>
						<input type="text" placeholder="Type your msg here .." id="msgtext" width="100%"/>
						<br />
						<button>Send</button>
					</td>
				</tr>
			</table>
		</div>
	</div>
	
	
	<script>
		//var friendname = prompt('what is your friend username ?');
		//var name = <?php echo $username; ?>;
		 
		var name = prompt('what is your username ?');
		var friendname = prompt('what is your friend username ?');
		var log = document.getElementById('log');
			
		var sock = new WebSocket("ws://localhost:5001");
		
		sock.onopen = function(){
			sock.send(JSON.stringify({
				type: "open_chat",
				fromname: name,
				toname: friendname
			}));
		}

		sock.onmessage = function(event){
			console.log(event);
			var json = JSON.parse(event.data);
			if(json.name=="You"){
				log.innerHTML += ("<div style=\"display: inline; word-break: break-all; word-wrap: break-word; width: 180px; overflow-y: auto; border-radius: 15px; float: right; background: white; padding: 7px; border: solid 1px black;\"> <span style=\"color: red;\">"+ json.name +": "+ "<span style=\"color: blue;\"> "+json.data + "</span></div><br/><br/>");
			}else{
				log.innerHTML += ("<div style=\"display: inline; word-break: break-all; word-wrap: break-word; width: 180px; overflow-y: auto; border-radius: 15px; float: left;  background: yellow; padding: 7px; border: solid 1px black;\"> <span style=\"color: red;\">"+ json.name +": "+ "<span style=\"color: blue;\"> "+json.data + "</span></div><br/><br/>");
			}
			//log.innerHTML += '<div style="float: right;"> <span style="color: red;">'+ json.name +": "+ '<span style="color: blue;"> '+json.data + '</span></div>'+'<br/>';
			$('#log').animate({scrollTop: $('#log').prop("scrollHeight")}, 1000);
		}
		
		document.querySelector('#msgtext').addEventListener('keypress', function (e) {
			var key = e.which || e.keyCode;
			if (key === 13) { // 13 is enter
				var text = document.getElementById('msgtext');
				sock.send(JSON.stringify({
					type: "message",
					data: text.value
				}));
				text.value = "";
				text.focus();
			}
		});
		
		document.querySelector('button').onclick = function(){
			var text = document.getElementById('msgtext');
			sock.send(JSON.stringify({
				type: "message",
				data: text.value
			}));
			text.value = "";
			text.focus();
		};
		
			/*sock.onopen = function(event){
			//alert('Successfully !!!');
			setTimeout( function(){
				sock.send("hey there");
			}, 1000);
			};*/
		
	</script>
</body>
</html>